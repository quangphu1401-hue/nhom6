<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./assets/css/style.css">
    <link rel="stylesheet" href="./assets/css/reponsive.css">
    <link rel="stylesheet" href="/assets/fonts/themify-icons/themify-icons.css">
    <link rel="icon" href="./assets/img/map/favicon1.jpg" type="image/x-icon" />

    <title>AgroBI - H·ªá Th·ªëng Kinh Doanh Th√¥ng Minh N√¥ng Nghi·ªáp</title>
</head>

<body>
    <div id="main">
        <div id="header">
            <!--Begin nav-->
            <ul id="nav">
                <li><a href="#">Trang Ch·ªß</a></li>
                <li><a href="#band">Gi·ªõi Thi·ªáu</a></li>
                <li><a href="#tour">K·∫ø Ho·∫°ch M√πa V·ª•</a></li>
                <li><a href="#contact">Li√™n H·ªá</a></li>
                <li>
                    <a href="#">
                        D·ªãch V·ª•
                        <i class=" nav-arrow-down ti-angle-down"></i>
                    </a>
                    <ul class="subnav">
                        <li><a href="#care-guide">H∆∞·ªõng d·∫´n chƒÉm s√≥c</a></li>
                        <li><a href="#dashboard">Trung t√¢m ƒëi·ªÅu h√†nh</a></li>
                    </ul>
                </li>
            </ul>
            <!--End nav-->

            <!-- Begin: search button -->
            <div class="search-btn">
                <i class="search-icon ti-search"></i>
            </div>

            <!-- <div id="mobile-menu" class="mobile-menu-btn">
            <i class="menu-icon ti-menu"></i>
        </div> -->

            <!-- End: search button -->
        </div>

        <div id="slider">
            <div class="text-conten">
                <h2 class="text-heading">AgroBI Platform</h2>
                <div class="text-description">Gi·∫£i ph√°p AI & T·ª± ƒë·ªông h√≥a cho qu·∫£n l√Ω n√¥ng nghi·ªáp hi·ªáu qu·∫£.</div>
            </div>
        </div>

        <div id="content">
            <!-- About Section -->
            <div id="band" class="content-section">
                <h2 class="section-heading">V·ªÄ AGRABI</h2>
                <p class="section-sub-heading">C√¥ng ngh·ªá th√¥ng minh cho n√¥ng nghi·ªáp</p>
                <p class="about-text">AgroBI l√† n·ªÅn t·∫£ng h·ªá th·ªëng kinh doanh th√¥ng minh ƒë∆∞·ª£c thi·∫øt k·∫ø ƒë·∫∑c bi·ªát cho lƒ©nh v·ª±c n√¥ng nghi·ªáp. Ch√∫ng t√¥i t√≠ch h·ª£p c√¥ng ngh·ªá AI (Tr√≠ tu·ªá nh√¢n t·∫°o), BI (Business Intelligence) v√† T·ª± ƒë·ªông h√≥a d·ªØ li·ªáu ƒë·ªÉ h·ªó tr·ª£ n√¥ng d√¢n v√† doanh nghi·ªáp
                    n√¥ng nghi·ªáp trong qu·∫£n l√Ω m√πa v·ª•, d·ª± b√°o s·∫£n l∆∞·ª£ng, t·ªëi ∆∞u h√≥a chi ph√≠ v√† ra quy·∫øt ƒë·ªãnh kinh doanh. H·ªá th·ªëng c·ªßa ch√∫ng t√¥i cung c·∫•p ph√¢n t√≠ch chuy√™n s√¢u v·ªÅ ƒëi·ªÅu ki·ªán ƒë·∫•t, th·ªùi ti·∫øt, s√¢u b·ªánh v√† th·ªã tr∆∞·ªùng ƒë·ªÉ gi√∫p b·∫°n tƒÉng nƒÉng su·∫•t
                    v√† l·ª£i nhu·∫≠n. V·ªõi giao di·ªán th√¢n thi·ªán v√† c√°c c√¥ng c·ª• m·∫°nh m·∫Ω, AgroBI gi√∫p hi·ªán ƒë·∫°i h√≥a ho·∫°t ƒë·ªông n√¥ng nghi·ªáp c·ªßa b·∫°n, t·ª´ l·∫≠p k·∫ø ho·∫°ch ƒë·∫øn thu ho·∫°ch.</p>

                <div class="row members-list">
                    <div class="col col-third text-center">
                        <p class="member-name">Qu·∫£n l√Ω M√πa V·ª•</p>
                        <img src="./assets/img/agrabi/muavu.jpg" alt="Qu·∫£n l√Ω" class="member-img">
                    </div>
                    <div class="col col-third text-center">
                        <p class="member-name">Ph√¢n T√≠ch D·ªØ Li·ªáu</p>
                        <img src="./assets/img/agrabi/phantich.png" alt="D·ªØ li·ªáu" class="member-img">
                    </div>
                    <div class="col col-third text-center">
                        <p class="member-name">D·ª± B√°o & Quy·∫øt ƒê·ªãnh</p>
                        <img src="./assets/img/agrabi/dubao.jpg" alt="D·ª± b√°o" class="member-img">
                    </div>
                </div>
            </div>

            <!-- Tour Section -->
            <div id="tour" class="tour-section">
                <div class="content-section">
                    <h2 class="section-heading">K·∫æ HO·∫†CH M√ôA V·ª§</h2>
                    <p class="section-sub-heading">L√™n k·∫ø ho·∫°ch s·∫£n xu·∫•t v·ªõi AI v√† d·ªØ li·ªáu ch√≠nh x√°c</p>

                    <!-- Tickets -->
                    <ul class="tickets-list">
                        <li>Qu√Ω I - M√πa Xu√¢n <span class="quantity">S·∫µn s√†ng</span></li>
                        <li>Qu√Ω II - M√πa H·∫° <span class="quantity">S·∫µn s√†ng</span></li>
                        <li>Qu√Ω III - M√πa Thu <span class="quantity">ƒêang th·ª±c hi·ªán</span></li>
                        <li>Qu√Ω IV - M√πa ƒê√¥ng <span class="quantity">Ch∆∞a th·ª±c hi·ªán</span></li>
                    </ul>

                    <!-- Place -->
                    <div class="row places-list">
                        <div class="col col-third">
                            <img src="./assets/img/place/luagao.jpg" alt="L√∫a G·∫°o" class="place-img">
                            <div class="place-body">
                                <h3 class="playheading">L√∫a G·∫°o</h3>
                                <p class="place-time">M√πa v·ª•: Th√°ng 5-9</p>
                                <p class="place-desc">Gi√°m s√°t th·ª±c th·ªùi v·ªÅ ƒë·ªô ·∫©m ƒë·∫•t, nhi·ªát ƒë·ªô v√† s√¢u b·ªánh. T·ªëi ∆∞u h√≥a l·ªãch t∆∞·ªõi ti√™u v√† b√≥n ph√¢n v·ªõi AI.</p>
                                <button class="btn s-full-width js-buy-ticket">Xem Chi Ti·∫øt</button >
                        </div>
                        </div>

                        <div class="col col-third">
                            <img src="./assets/img/place/raucuqua.jpg" alt="Rau C·ªß" class="place-img">
                        <div class="place-body">
                            <h3 class="playheading">Rau C·ªß Qu·∫£</h3>
                            <p class="place-time">M√πa v·ª•: Quanh nƒÉm</p>
                            <p class="place-desc">D·ª± b√°o nhu c·∫ßu th·ªã tr∆∞·ªùng, qu·∫£n l√Ω v√≤ng ƒë·ªùi c√¢y tr·ªìng, ph√°t hi·ªán b·ªánh t·∫≠t s·ªõm, tƒÉng nƒÉng su·∫•t v√† ch·∫•t l∆∞·ª£ng.</p>
                            <button class="btn s-full-width js-buy-ticket">Xem Chi Ti·∫øt</button>
                            </div>
                        </div>

                        <div class="col col-third">
                            <img src="./assets/img/place/caycongnghiep.jpg" alt="C√¢y C√¥ng Nghi·ªáp" class="place-img">
                            <div class="place-body">
                                <h3 class="playheading">C√¢y C√¥ng Nghi·ªáp</h3>
                                <p class="place-time">M√πa v·ª•: Th√°ng 10-2</p>
                                <p class="place-desc">Qu·∫£n l√Ω to√†n b·ªô quy tr√¨nh t·ª´ gieo h·∫°t ƒë·∫øn thu ho·∫°ch v·ªõi h·ªá th·ªëng t·ª± ƒë·ªông h√≥a, gi√°m s√°t v√† ph√¢n t√≠ch d·ªØ li·ªáu th·ªùi gian th·ª±c.</p>
                                <button class="btn s-full-width js-buy-ticket">Xem Chi Ti·∫øt</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ================= H∆Ø·ªöNG D·∫™N CHƒÇM S√ìC ================= -->
            <div id="care-guide" class="content-section">

                <h2 class="section-heading">H∆Ø·ªöNG D·∫™N CHƒÇM S√ìC C√ÇY TR·ªíNG</h2>
                <p class="section-sub-heading">Khuy·∫øn ngh·ªã k·ªπ thu·∫≠t theo t·ª´ng lo·∫°i c√¢y</p>

                <div class="row guide-grid">

                    <div class="col col-third">
                        <div class="guide-card">
                            <h3>üåæ L√∫a</h3>
                            <ul>
                                <li>Gieo s·∫° ƒë√∫ng th·ªùi v·ª•, tr√°nh m∆∞a l·ªõn</li>
                                <li>T∆∞·ªõi n∆∞·ªõc ƒë·ªãnh k·ª≥, gi·ªØ m·ª±c n∆∞·ªõc 3‚Äì5cm</li>
                                <li>B√≥n ph√¢n NPK 3 giai ƒëo·∫°n</li>
                                <li>Ph√≤ng tr·ª´ s√¢u cu·ªën l√°</li>
                            </ul>
                        </div>
                    </div>

                    <div class="col col-third">
                        <div class="guide-card">
                            <h3>ü•¨ Rau m√†u</h3>
                            <ul>
                                <li>ƒê·∫•t t∆°i x·ªëp, tho√°t n∆∞·ªõc t·ªët</li>
                                <li>T∆∞·ªõi s√°ng s·ªõm ho·∫∑c chi·ªÅu m√°t</li>
                                <li>B√≥n ph√¢n h·ªØu c∆°, h·∫°n ch·∫ø h√≥a h·ªçc</li>
                                <li>Ph√≤ng s√¢u ƒÉn l√°, n·∫•m b·ªánh</li>
                            </ul>
                        </div>
                    </div>

                    <div class="col col-third">
                        <div class="guide-card">
                            <h3>üå≥ C√¢y c√¥ng nghi·ªáp</h3>
                            <ul>
                                <li>Ch·ªçn gi·ªëng ph√π h·ª£p kh√≠ h·∫≠u</li>
                                <li>T·ªâa c√†nh, t·∫°o t√°n ƒë·ªãnh k·ª≥</li>
                                <li>B√≥n ph√¢n theo chu k·ª≥ sinh tr∆∞·ªüng</li>
                                <li>Ki·ªÉm so√°t s√¢u b·ªánh t·ªïng h·ª£p</li>
                            </ul>
                        </div>
                    </div>

                </div>
            </div>

            <!-- ================= NH·∫¨N DI·ªÜN C√îN TR√ôNG T·ª™ ·∫¢NH ================= -->
            <div id="pest-image-identification" class="content-section">
                <h2 class="section-heading">NH·∫¨N DI·ªÜN C√îN TR√ôNG T·ª™ ·∫¢NH</h2>
                <p class="section-sub-heading">Upload ·∫£nh c√¥n tr√πng ƒë·ªÉ AI ph√¢n t√≠ch c√≥ l·ª£i hay c√≥ h·∫°i</p>

                <div class="row">
                    <div class="col col-half">
                        <div class="upload-card">
                            <h3>üì∏ Upload ·∫¢nh</h3>
                            <div class="upload-area" id="uploadArea">
                                <input type="file" id="pestImageInput" accept="image/*" style="display: none;">
                                <div class="upload-placeholder" onclick="document.getElementById('pestImageInput').click()">
                                    <i class="ti-upload" style="font-size: 48px; color: #4CAF50;"></i>
                                    <p>Click ƒë·ªÉ ch·ªçn ·∫£nh ho·∫∑c k√©o th·∫£ ·∫£nh v√†o ƒë√¢y</p>
                                    <p style="font-size: 12px; color: #999;">H·ªó tr·ª£: JPG, PNG, WebP</p>
                                </div>
                                <img id="previewImage" style="display: none; max-width: 100%; max-height: 300px; margin-top: 10px; border-radius: 8px;">
                            </div>
                            <div style="margin-top: 15px;">
                                <input type="text" id="pestLocation" placeholder="V·ªã tr√≠ (t√πy ch·ªçn)" class="form-control" style="margin-bottom: 10px;">
                                <button class="btn" onclick="analyzePestImage()" id="analyzeBtn" disabled>üîç Ph√¢n T√≠ch ·∫¢nh</button>
                                <button class="btn" onclick="resetImageUpload()" style="background: #999; margin-left: 10px;">üîÑ Reset</button>
                            </div>
                        </div>
                    </div>

                    <div class="col col-half">
                        <div class="result-card" id="pestResultCard" style="display: none;">
                            <h3>üìä K·∫øt Qu·∫£ Ph√¢n T√≠ch</h3>
                            <div id="pestResultContent">
                                <!-- K·∫øt qu·∫£ s·∫Ω hi·ªÉn th·ªã ·ªü ƒë√¢y -->
                            </div>
                        </div>
                        <div class="result-card" id="pestLoadingCard" style="display: none;">
                            <h3>‚è≥ ƒêang ph√¢n t√≠ch...</h3>
                            <p>AI ƒëang x·ª≠ l√Ω ·∫£nh c·ªßa b·∫°n, vui l√≤ng ƒë·ª£i...</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="dashboard-section">

                <div id="dashboard" class="inner">

                    <h2 class="section-heading">TRUNG T√ÇM ƒêI·ªÄU H√ÄNH N√îNG NGHI·ªÜP</h2>
                    <p class="section-sub-heading">Gi√°m s√°t m√πa v·ª• ‚Ä¢ D·ª± b√°o th·ªùi ti·∫øt ‚Ä¢ Ph√¢n t√≠ch nƒÉng su·∫•t</p>

                    <div class="row dashboard-grid">

                        <div class="col col-third">
                            <div class="dashboard-card" id="weatherCard">
                                <h3>üå¶Ô∏è Th·ªùi Ti·∫øt</h3>
                                <p id="weatherLocation">ƒêang t·∫£i...</p>
                                <p id="weatherTemp">Nhi·ªát ƒë·ªô: --</p>
                                <p id="weatherHumidity">ƒê·ªô ·∫©m: --</p>
                                <p id="weatherPrecip">L∆∞·ª£ng m∆∞a: --</p>
                                <p id="weatherWarning">C·∫£nh b√°o: --</p>
                                <button class="btn" onclick="loadWeather()">C·∫≠p nh·∫≠t</button>
                            </div>
                        </div>

                        <div class="col col-third">
                            <div class="dashboard-card" id="cropCard">
                                <h3>üå± M√πa V·ª•</h3>
                                <p id="cropName">ƒêang t·∫£i...</p>
                                <p id="cropStage">Giai ƒëo·∫°n: --</p>
                                <p id="cropArea">Di·ªán t√≠ch: --</p>
                                <p id="cropHarvest">Thu ho·∫°ch d·ª± ki·∫øn: --</p>
                                <button class="btn" onclick="loadCrops()">C·∫≠p nh·∫≠t</button>
                            </div>
                        </div>

                        <div class="col col-third">
                            <div class="dashboard-card">
                                <h3>üßë‚Äçüåæ C√¥ng vi·ªác h√¥m nay</h3>
                                <ul class="task-list">
                                    <p>Ki·ªÉm tra s√¢u b·ªánh</p>
                                    <p>T∆∞·ªõi ti√™u khu A</p>
                                    <p>B√≥n ph√¢n l√∫a</p>
                                </ul>
                            </div>
                        </div>

                    </div>

                    <div class="dashboard-analytics">
                        <h3>Th·ªëng k√™ & Ph√¢n t√≠ch</h3>
                        <div id="shiCard" style="background: white; padding: 20px; border-radius: 8px; margin-bottom: 15px;">
                            <h4>üìä Ch·ªâ s·ªë SHI (Season Health Index)</h4>
                            <p id="shiScore" style="font-size: 24px; font-weight: bold; color: #4CAF50;">--</p>
                            <p id="shiStatus">ƒêang t√≠nh to√°n...</p>
                            <div id="shiDetails" style="margin-top: 10px; font-size: 12px; color: #666;">
                                <p>ƒêi·ªÉm th·ªùi ti·∫øt: <span id="weatherScoreDetail">--</span></p>
                                <p>ƒêi·ªÉm chƒÉm s√≥c: <span id="careScoreDetail">--</span></p>
                                <p>ƒêi·ªÉm giai ƒëo·∫°n: <span id="growthScoreDetail">--</span></p>
                            </div>
                            <button class="btn" onclick="loadSHI()" style="margin-top: 10px;">T√≠nh SHI</button>
                        </div>
                        <div id="warningsCard" style="background: #fff3cd; padding: 15px; border-radius: 8px; border-left: 4px solid #ffc107; display: none;">
                            <h4>‚ö†Ô∏è C·∫£nh B√°o</h4>
                            <div id="warningsList"></div>
                        </div>
                        <div style="margin-top: 15px;">
                            <p>NƒÉng su·∫•t: 6.5 t·∫•n/ha</p>
                            <p>Chi ph√≠: 32 tri·ªáu VND</p>
                            <p>L·ª£i nhu·∫≠n: 45 tri·ªáu VND</p>
                        </div>
                    </div>

                    <div class="dashboard-map-section mt-16">
                        <h3>B·∫¢N ƒê·ªí D·ª∞ B√ÅO TH·ªúI TI·∫æT THEO KHU V·ª∞C</h3>
                        <div class="row">
                            <div class="col col-half">
                                <div class="map-box">
                                    <iframe src="https://www.openstreetmap.org/export/embed.html?bbox=105.7,20.9,105.9,21.1&layer=mapnik" loading="lazy">
                </iframe>
                                </div>
                            </div>

                            <div class="col col-half">
                                <div class="forecast-box">
                                    <h4>üå¶Ô∏è D·ª± b√°o H√† N·ªôi (7 ng√†y)</h4>
                                    <ul class="forecast-list" id="forecastList">
                                        <li>ƒêang t·∫£i d·ª± b√°o...</li>
                                    </ul>
                                    <button class="btn" onclick="loadForecast()">C·∫≠p nh·∫≠t d·ª± b√°o</button>
                                </div>
                            </div>
                        </div>
                    </div>


                </div>

            </div>




            <!--Begin Contact Section -->
            <div id="contact" class="content-section">
                <h2 class="section-heading">LI√äN H·ªÜ</h2>
                <p class="section-sub-heading">H√£y li√™n h·ªá v·ªõi ch√∫ng t√¥i ƒë·ªÉ t√¨m hi·ªÉu th√™m!</p>

                <div class="row contact-content">
                    <div class="col col-half contact-info">
                        <p><i class="ti-location-pin"></i>H√† N·ªôi, Vi·ªát Nam</p>
                        <p><i class="ti-mobile"></i>ƒêi·ªán tho·∫°i: 0866816201</p>
                        <p><i class="ti-email"></i>Email: NguyenNgocHoan@gmail.com</p>
                    </div>
                    <form action="">
                        <div class="col col-half contact-form">
                            <div class="row">
                                <div class="col col-half">
                                    <input type="text" name="" required placeholder="T√™n c·ªßa b·∫°n" id="" class="form-control">
                                </div>
                                <div class="col col-half">
                                    <input type="email" name="" required placeholder="Email" id="" class="form-control">
                                </div>
                            </div>
                            <div class="row mt-8">
                                <div class="col col-full">
                                    <input type="text" name="" required placeholder="L·ªùi nh·∫Øn" id="" class="form-control">
                                </div>
                            </div>
                            <input class="btn pull-right mt-16" type="submit" value="G·ª¨I">
                        </div>
                    </form>
                </div>
            </div>

            <!-- End Contact -->
            <div class="map-section">
                <img src="./assets/img/map/map1.jpg" alt="Map">
            </div>
        </div>
    </div>

    <div id="footer">
        <div class="socials-list">
            <a href="#"><i class="ti-facebook"></i></a>
            <a href="#"><i class="ti-instagram"></i></a>
            <a href="#"><i class="ti-youtube"></i></a>
            <a href="#"><i class="ti-pinterest"></i></a>
            <a href="#"><i class="ti-twitter"></i></a>
            <a href="#"><i class="ti-linkedin"></i></a>
        </div>
        <p class="copyright">Copyright &copy; 2025 AgroBI - H·ªá th·ªëng Kinh Doanh Th√¥ng Minh N√¥ng Nghi·ªáp</p>
    </div>
    </div>

    <div class="modal js-modal">
        <div class="modal-container js-modal-container">
            <div class="modal-close js-modal-close">
                <div class="ti-close"></div>
            </div>

            <header class="modal-header">
                <i class="modal-heading-icon ti-bag"></i> Th√¥ng Tin Chi Ti·∫øt
            </header>

            <div class="modal-body">
                <label for="ticket-quantity" class="modal-label">
                <i class="ti-shopping-cart"></i>
                Di·ªán t√≠ch canh t√°c (ha)
            </label>
                <input id="ticket-quantity" type="text" class="modal-input" required placeholder="Nh·∫≠p di·ªán t√≠ch...">
                <label for="ticket-email" class="modal-label">
                <i class="ti-user"></i>
                Email li√™n h·ªá
            </label>
                <input id="ticket-email" type="email" class="modal-input" placeholder="Nh·∫≠p email...">

                <button class="buy-tickets" onclick="submitCropInfo()">G·ª≠i Th√¥ng Tin
                <i class="ti-check"></i>
            </button>
            </div>

            <footer class="modal-footer">
                <p class="modal-help">C·∫ßn <a href="#">h·ªó tr·ª£?</a>
                </p>
            </footer>

        </div>
    </div>
    </div>

    <!-- API Integration -->
    <script src="./assets/js/api.js"></script>

    <script>
        const buyBtns = document.querySelectorAll('.js-buy-ticket');
        const modal = document.querySelector('.js-modal');
        const modalClose = document.querySelector('.js-modal-close');
        const modalContainer = document.querySelector('.js-modal-container');

        //H√†m hi·ªÉn th·ªã modal th√¥ng tin chi ti·∫øt
        function showBuyTickets() {
            modal.classList.add('open');
        }

        //h√†m ·∫©n modal th√¥ng tin chi ti·∫øt (·∫•n X ƒë·ªÉ ƒë√≥ng)
        function hideBuyTickets() {
            modal.classList.remove('open');
        }

        //L·∫∑p qua t·ª´ng th·∫ª button v√† nghe s·ª± ki·ªán click
        for (const buyBtn of buyBtns) {
            buyBtn.addEventListener('click', showBuyTickets);
        }

        //Nghe s·ª± ki·ªán click v√†o button ƒë√≥ng
        modalClose.addEventListener('click', hideBuyTickets);

        //Nghe s·ª± ki·ªán click v√†o n·ªÅn modal ƒë·ªÉ ƒë√≥ng modal
        modal.addEventListener('click', hideBuyTickets);

        modalContainer.addEventListener('click', function(event) {
            event.stopPropagation();
        })
    </script>

    <script>
        var header = document.getElementById('header');
        var mobileMenu = document.getElementById('mobile-menu');

        //ƒê√≥ng/m·ªü menu mobile
        mobileMenu.onclick = function() {
            // var isOpen = header.clientHeight ===46;
            // if(isClosed){
            //     header.style.height = 'auto';
            // } else{
            //     header.style.height = null;
            // }
        }

        //t·ª± ƒë·ªông ƒë√≥ng khi ch·ªçn menu
        var menuItems = document.querySelectorAll('#nav li a[href*="#"]');
    </script>

    <!-- ================= PLANT AI CHAT ================= -->
    <div id="plant-ai-btn">ü§ñ</div>

    <div id="plant-ai-chat">
        <div class="plant-header">Plant AI Assistant üå±</div>
        <div class="plant-body" id="plantMessages">
            <div class="plant-msg ai">Xin ch√†o! T√¥i c√≥ th·ªÉ gi√∫p g√¨ v·ªÅ c√¢y tr·ªìng, s√¢u b·ªánh ho·∫∑c th·ªùi ti·∫øt?</div>
        </div>
        <div class="plant-footer">
            <input id="plantInput" type="text" placeholder="Nh·∫≠p c√¢u h·ªèi...">
            <button onclick="sendPlantMessage()">G·ª≠i</button>
        </div>
    </div>

    <script>
        const aiBtn = document.getElementById("plant-ai-btn");
        const aiChat = document.getElementById("plant-ai-chat");

        aiBtn.onclick = () => {
            aiChat.style.display = aiChat.style.display === "flex" ? "none" : "flex";
        };
    </script>

    <script>
        // ==================== LOAD DATA FUNCTIONS ====================
        // ƒê·∫£m b·∫£o c√°c h√†m ·ªü global scope ƒë·ªÉ c√≥ th·ªÉ g·ªçi t·ª´ onclick

        // Load th·ªùi ti·∫øt hi·ªán t·∫°i (H√† N·ªôi: 21.0285, 105.8542)
        async function loadWeather() {
            const lat = 21.0285;
            const lon = 105.8542;

            try {
                const weather = await WeatherAPI.getCurrent(lat, lon);

                document.getElementById("weatherLocation").textContent = `Khu v·ª±c: ${weather.location || 'H√† N·ªôi'}`;
                document.getElementById("weatherTemp").textContent = `Nhi·ªát ƒë·ªô: ${weather.temperature?.toFixed(1) || '--'}¬∞C`;
                document.getElementById("weatherHumidity").textContent = `ƒê·ªô ·∫©m: ${weather.humidity || '--'}%`;
                document.getElementById("weatherPrecip").textContent = `L∆∞·ª£ng m∆∞a: ${weather.precipitation?.toFixed(1) || '0'}mm`;

                // C·∫£nh b√°o
                let warning = "Kh√¥ng c√≥";
                if (weather.temperature > 35 || weather.temperature < 10) {
                    warning = "Nhi·ªát ƒë·ªô b·∫•t th∆∞·ªùng";
                } else if (weather.precipitation > 50) {
                    warning = "M∆∞a l·ªõn";
                } else if (weather.humidity < 40) {
                    warning = "ƒê·ªô ·∫©m th·∫•p";
                }
                document.getElementById("weatherWarning").textContent = `C·∫£nh b√°o: ${warning}`;
            } catch (error) {
                console.error("Error loading weather:", error);
                document.getElementById("weatherLocation").textContent = "L·ªói: Backend ch∆∞a ch·∫°y ho·∫∑c API key ch∆∞a c·∫•u h√¨nh";
            }
        }

        // Load danh s√°ch m√πa v·ª•
        async function loadCrops() {
            try {
                const crops = await CropsAPI.getAll();

                if (crops && crops.length > 0) {
                    const crop = crops[0]; // L·∫•y m√πa v·ª• ƒë·∫ßu ti√™n
                    const stageNames = {
                        'seedling': 'C√¢y con',
                        'vegetative': 'Sinh tr∆∞·ªüng',
                        'flowering': 'Ra hoa',
                        'fruiting': 'ƒê·∫≠u qu·∫£',
                        'mature': 'Ch√≠n',
                        'harvest': 'Thu ho·∫°ch'
                    };

                    document.getElementById("cropName").textContent = `C√¢y tr·ªìng: ${crop.name || '--'}`;
                    document.getElementById("cropStage").textContent = `Giai ƒëo·∫°n: ${stageNames[crop.current_growth_stage] || crop.current_growth_stage || '--'}`;
                    document.getElementById("cropArea").textContent = `Di·ªán t√≠ch: ${crop.area_hectares || '--'} ha`;

                    if (crop.expected_harvest_date) {
                        const harvestDate = new Date(crop.expected_harvest_date);
                        document.getElementById("cropHarvest").textContent = `Thu ho·∫°ch d·ª± ki·∫øn: ${harvestDate.toLocaleDateString('vi-VN')}`;
                    } else {
                        document.getElementById("cropHarvest").textContent = "Thu ho·∫°ch d·ª± ki·∫øn: --";
                    }
                } else {
                    document.getElementById("cropName").textContent = "Ch∆∞a c√≥ m√πa v·ª• n√†o. T·∫°o m√πa v·ª• m·ªõi qua API.";
                }
            } catch (error) {
                console.error("Error loading crops:", error);
                document.getElementById("cropName").textContent = "L·ªói: Backend ch∆∞a ch·∫°y";
            }
        }

        // Load SHI v√† c·∫£nh b√°o
        async function loadSHI() {
            try {
                // L·∫•y crop ƒë·∫ßu ti√™n
                const crops = await CropsAPI.getAll();
                if (!crops || crops.length === 0) {
                    document.getElementById("shiScore").textContent = "Ch∆∞a c√≥ m√πa v·ª•";
                    return;
                }

                const cropId = crops[0].id;
                const shiData = await AnalyticsAPI.getSHI(cropId);

                // Hi·ªÉn th·ªã SHI
                const shiScore = shiData.shi_score || 0;
                document.getElementById("shiScore").textContent = shiScore.toFixed(1);

                // M√†u s·∫Øc theo ƒëi·ªÉm
                const shiElement = document.getElementById("shiScore");
                if (shiScore >= 80) {
                    shiElement.style.color = "#4CAF50"; // Xanh l√°
                } else if (shiScore >= 60) {
                    shiElement.style.color = "#8BC34A"; // Xanh nh·∫°t
                } else if (shiScore >= 40) {
                    shiElement.style.color = "#FFC107"; // V√†ng
                } else {
                    shiElement.style.color = "#F44336"; // ƒê·ªè
                }

                document.getElementById("shiStatus").textContent = `Tr·∫°ng th√°i: ${shiData.status_vn || '--'}`;
                document.getElementById("weatherScoreDetail").textContent = `${shiData.weather_score || 0} ƒëi·ªÉm`;
                document.getElementById("careScoreDetail").textContent = `${shiData.care_score || 0} ƒëi·ªÉm`;
                document.getElementById("growthScoreDetail").textContent = `${shiData.growth_score || 0} ƒëi·ªÉm`;

                // Hi·ªÉn th·ªã c·∫£nh b√°o
                const warnings = shiData.warnings || [];
                const warningsCard = document.getElementById("warningsCard");
                const warningsList = document.getElementById("warningsList");

                if (warnings.length > 0) {
                    warningsCard.style.display = "block";
                    warningsList.innerHTML = "";
                    warnings.forEach(warning => {
                        const warningDiv = document.createElement("div");
                        warningDiv.style.marginBottom = "10px";
                        warningDiv.style.padding = "10px";
                        warningDiv.style.background = warning.level === "high" ? "#f8d7da" : "#fff3cd";
                        warningDiv.style.borderRadius = "5px";
                        warningDiv.innerHTML = `
                    <strong>${warning.level === "high" ? "üî¥" : "üü°"} ${warning.message}</strong>
                `;
                        warningsList.appendChild(warningDiv);
                    });
                } else {
                    warningsCard.style.display = "none";
                }
            } catch (error) {
                console.error("Error loading SHI:", error);
                document.getElementById("shiScore").textContent = "L·ªói";
            }
        }

        // Load d·ª± b√°o th·ªùi ti·∫øt
        async function loadForecast() {
            const lat = 21.0285;
            const lon = 105.8542;

            try {
                const forecastData = await WeatherAPI.getForecast(lat, lon, 7);
                const forecastList = document.getElementById("forecastList");
                forecastList.innerHTML = "";

                if (forecastData.forecast && forecastData.forecast.length > 0) {
                    // Nh√≥m theo ng√†y
                    const dailyForecast = {};
                    forecastData.forecast.forEach(item => {
                        const date = new Date(item.forecast_date);
                        const dateKey = date.toLocaleDateString('vi-VN');
                        if (!dailyForecast[dateKey]) {
                            dailyForecast[dateKey] = item;
                        }
                    });

                    // Hi·ªÉn th·ªã 7 ng√†y
                    Object.entries(dailyForecast).slice(0, 7).forEach(([date, item]) => {
                        const li = document.createElement("li");
                        li.textContent = `${date}: ${item.temperature?.toFixed(1) || '--'}¬∞C | ${item.weather_description || '--'}`;
                        forecastList.appendChild(li);
                    });
                } else {
                    forecastList.innerHTML = "<li>Kh√¥ng c√≥ d·ªØ li·ªáu d·ª± b√°o</li>";
                }
            } catch (error) {
                console.error("Error loading forecast:", error);
                document.getElementById("forecastList").innerHTML = "<li>L·ªói: Backend ch∆∞a ch·∫°y ho·∫∑c API key ch∆∞a c·∫•u h√¨nh</li>";
            }
        }

        // H√†m x·ª≠ l√Ω khi submit th√¥ng tin m√πa v·ª•
        async function submitCropInfo() {
            const area = document.getElementById("ticket-quantity").value;
            const email = document.getElementById("ticket-email").value;

            if (!area || parseFloat(area) <= 0) {
                alert("Vui l√≤ng nh·∫≠p di·ªán t√≠ch canh t√°c h·ª£p l·ªá!");
                return;
            }

            // T·∫°o m√πa v·ª• m·ªõi
            try {
                const cropData = {
                    name: `M√πa v·ª• ${new Date().getFullYear()}`,
                    crop_type: "coffee_robusta",
                    planting_date: new Date().toISOString().split('T')[0],
                    area_hectares: parseFloat(area),
                    location: "H√† N·ªôi",
                    latitude: 21.0285,
                    longitude: 105.8542,
                    notes: `Email li√™n h·ªá: ${email || 'Kh√¥ng c√≥'}`
                };

                const response = await CropsAPI.create(cropData);

                // ƒê√≥ng modal
                hideBuyTickets();

                // Hi·ªÉn th·ªã th√¥ng b√°o th√†nh c√¥ng
                alert(`‚úÖ ƒê√£ t·∫°o m√πa v·ª• th√†nh c√¥ng!\n\nT√™n: ${response.name}\nDi·ªán t√≠ch: ${response.area_hectares} ha\nGiai ƒëo·∫°n: ${response.current_growth_stage}\nTu·ªïi c√¢y: ${response.age_days} ng√†y`);

                // Reload danh s√°ch m√πa v·ª•
                loadCrops();

                // Reset form
                document.getElementById("ticket-quantity").value = "";
                document.getElementById("ticket-email").value = "";
            } catch (error) {
                console.error("Error creating crop:", error);
                alert(`‚ùå L·ªói khi t·∫°o m√πa v·ª•: ${error.message}\n\nVui l√≤ng ki·ªÉm tra:\n- Backend ƒëang ch·∫°y (http://localhost:8000)\n- K·∫øt n·ªëi internet`);
            }
        }

        // T·ª± ƒë·ªông load khi trang ƒë∆∞·ª£c t·∫£i
        window.addEventListener('DOMContentLoaded', () => {
            loadWeather();
            loadCrops();
            loadForecast();
            loadSHI();
        });

        async function sendPlantMessage() {
            const input = document.getElementById("plantInput");
            const msgBox = document.getElementById("plantMessages");

            if (input.value.trim() === "") return;

            const question = input.value.trim();

            // Hi·ªÉn th·ªã c√¢u h·ªèi c·ªßa user
            const userMsg = document.createElement("div");
            userMsg.className = "plant-msg user";
            userMsg.innerText = question;
            msgBox.appendChild(userMsg);

            // Hi·ªÉn th·ªã loading
            const aiMsg = document.createElement("div");
            aiMsg.className = "plant-msg ai";
            aiMsg.innerText = "üåø T√¥i ƒëang x·ª≠ l√Ω c√¢u h·ªèi v·ªÅ c√¢y tr·ªìng c·ªßa b·∫°n...";
            msgBox.appendChild(aiMsg);

            input.value = "";
            msgBox.scrollTop = msgBox.scrollHeight;

            try {
                // G·ªçi AI Assistant API
                const response = await AIAssistantAPI.ask(question);
                aiMsg.innerText = response.answer || "Xin l·ªói, t√¥i kh√¥ng th·ªÉ tr·∫£ l·ªùi c√¢u h·ªèi n√†y.";
            } catch (error) {
                console.error("Error calling AI API:", error);
                aiMsg.innerText = "‚ùå L·ªói k·∫øt n·ªëi API. Vui l√≤ng ki·ªÉm tra backend ƒë√£ ch·∫°y ch∆∞a (http://localhost:8000)";
            }

            msgBox.scrollTop = msgBox.scrollHeight;
        }

        // ==================== IMAGE UPLOAD FUNCTIONS ====================

        function setupImageUpload() {
            const input = document.getElementById("pestImageInput");
            const uploadArea = document.getElementById("uploadArea");

            if (!input || !uploadArea) return;

            input.addEventListener("change", function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById("previewImage");
                        preview.src = e.target.result;
                        preview.style.display = "block";
                        document.getElementById("analyzeBtn").disabled = false;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Drag and drop
            uploadArea.addEventListener("dragover", function(e) {
                e.preventDefault();
                uploadArea.style.background = "#f0f0f0";
            });

            uploadArea.addEventListener("dragleave", function(e) {
                e.preventDefault();
                uploadArea.style.background = "";
            });

            uploadArea.addEventListener("drop", function(e) {
                e.preventDefault();
                uploadArea.style.background = "";
                const file = e.dataTransfer.files[0];
                if (file && file.type.startsWith("image/")) {
                    const dataTransfer = new DataTransfer();
                    dataTransfer.items.add(file);
                    input.files = dataTransfer.files;
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById("previewImage");
                        preview.src = e.target.result;
                        preview.style.display = "block";
                        document.getElementById("analyzeBtn").disabled = false;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        async function analyzePestImage() {
            const input = document.getElementById("pestImageInput");
            const location = document.getElementById("pestLocation").value;

            if (!input.files || !input.files[0]) {
                alert("Vui l√≤ng ch·ªçn ·∫£nh tr∆∞·ªõc!");
                return;
            }

            const file = input.files[0];
            const formData = new FormData();
            formData.append("file", file);
            if (location) {
                formData.append("location", location);
            }

            // Hi·ªÉn th·ªã loading
            document.getElementById("pestResultCard").style.display = "none";
            document.getElementById("pestLoadingCard").style.display = "block";
            document.getElementById("analyzeBtn").disabled = true;

            try {
                const response = await fetch("http://localhost:8000/api/pests/identify-image", {
                    method: "POST",
                    body: formData
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                displayPestResult(result);
            } catch (error) {
                console.error("Error analyzing image:", error);
                document.getElementById("pestResultContent").innerHTML = `
            <div style="color: red; padding: 15px;">
                <h4>‚ùå L·ªói</h4>
                <p>Kh√¥ng th·ªÉ ph√¢n t√≠ch ·∫£nh. Vui l√≤ng ki·ªÉm tra:</p>
                <ul>
                    <li>Backend ƒëang ch·∫°y (http://localhost:8000)</li>
                    <li>·∫¢nh c√≥ ƒë·ªãnh d·∫°ng h·ª£p l·ªá (JPG, PNG)</li>
                    <li>K·∫øt n·ªëi internet ·ªïn ƒë·ªãnh</li>
                </ul>
                <p>Chi ti·∫øt: ${error.message}</p>
            </div>
        `;
                document.getElementById("pestResultCard").style.display = "block";
            } finally {
                document.getElementById("pestLoadingCard").style.display = "none";
                document.getElementById("analyzeBtn").disabled = false;
            }
        }

        function displayPestResult(result) {
            const content = document.getElementById("pestResultContent");
            const isBeneficial = result.is_beneficial;
            const beneficialBadge = isBeneficial === true ?
                '<span style="background: #4CAF50; color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold;">‚úÖ C√ì L·ª¢I</span>' :
                isBeneficial === false ?
                '<span style="background: #f44336; color: white; padding: 5px 10px; border-radius: 5px; font-weight: bold;">‚ùå C√ì H·∫†I</span>' :
                '<span style="background: #999; color: white; padding: 5px 10px; border-radius: 5px;">‚ùì CH∆ØA X√ÅC ƒê·ªäNH</span>';

            content.innerHTML = `
        <div style="padding: 15px;">
            <h4>${result.identified_pest_name || "Ch∆∞a x√°c ƒë·ªãnh"}</h4>
            <p style="margin: 10px 0;">${beneficialBadge}</p>
            
            <div style="margin: 15px 0;">
                <strong>ƒê·ªô tin c·∫≠y:</strong> ${(result.confidence_score * 100).toFixed(1)}%<br>
                <strong>Lo·∫°i:</strong> ${result.pest_type || "unknown"}<br>
                ${result.severity ? `<strong>M·ª©c ƒë·ªô:</strong> ${result.severity}<br>` : ''}
            </div>
            
            <div style="background: #f5f5f5; padding: 15px; border-radius: 8px; margin-top: 15px;">
                <strong>üí° Khuy·∫øn ngh·ªã:</strong>
                <p style="margin-top: 10px;">${result.recommendation || "Kh√¥ng c√≥ khuy·∫øn ngh·ªã"}</p>
            </div>
        </div>
    `;
    
    document.getElementById("pestResultCard").style.display = "block";
}

function resetImageUpload() {
    document.getElementById("pestImageInput").value = "";
    document.getElementById("previewImage").style.display = "none";
    document.getElementById("previewImage").src = "";
    document.getElementById("pestLocation").value = "";
    document.getElementById("pestResultCard").style.display = "none";
    document.getElementById("pestLoadingCard").style.display = "none";
    document.getElementById("analyzeBtn").disabled = true;
}

// G·ªçi setup khi trang load
window.addEventListener('DOMContentLoaded', () => {
    setupImageUpload();
});
    </script>


</body>

</html>